---
title: 统计Git提交时修改文件数量
categories:
- 工具脚本
tags: [脚本]
---

目前我的需求是记录每次提交时被修改的文件，包括 Scala、Java、Markdown文本。

使用时在当前项目根目录执行，（如：cs-summary-reflection/）传入一个参数作为Git提交时的注释，如下：

```shell
bash custom-git.sh "测试脚本"
```
需要注意的本脚本是在Mac上执行的，使用bash，并且没有统计其他文件的修改。因为后面用了`add .`，所以一定要把不提交的文件放进`.gitignore`

打印日志如下：
```
当前分支：master
当前时间：2019-09-22 19:32:18
共有Scala文件：83，共有Java文件：473，共有markdown文件：70
本次共修改Java文件数：0，本次共修改Scala文件数：0，本次共修改markdown文件数：0
本次共删除Java文件数：0，本次共删除Scala文件数：0，本次共删除markdown文件数：0
本次共新增文件数：0
[master 9bbfda3] 测试脚本，时间：2019-09-22 19:32:18
 1 file changed, 4 insertions(+), 4 deletions(-)
Enumerating objects: 5, done.
Counting objects: 100% (5/5), done.
Delta compression using up to 8 threads
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 470 bytes | 470.00 KiB/s, done.
Total 3 (delta 2), reused 0 (delta 0)
remote: Resolving deltas: 100% (2/2), completed with 2 local objects.
To https://github.com/jxnu-liguobin/cs-summary-reflection.git
   d656253..9bbfda3  master -> master
```

脚本源代码如下：
```shell
#!/bin/bash

export  LANG=en_US.UTF-8
export LANG=zh_CN.UTF-8


# bash custom-git.sh "提交的注释"

starttime=`date +'%Y-%m-%d %H:%M:%S'`

branch=`git branch -a | grep "*" | awk '{print $2}'`
echo "当前分支：$branch"
echo "当前时间：$starttime"

scalaFile=`echo -e $(find . -name "*.scala" | wc -l) | awk '{a+=$1}END{print a}'`
javaFile=`echo -e $(find . -name "*.java" | wc -l) | awk '{a+=$1}END{print a}'`
mdFile=`echo -e $(find . -name "*.md" | wc -l) | awk '{a+=$1}END{print a}'`
echo "共有Scala文件：${scalaFile}，共有Java文件：${javaFile}，共有markdown文件：${mdFile}"

#显示修改
modifyJavaFile=`git status | grep "modified:" |  grep -G "\.java$" | wc -l | awk '{print $1}'`
modifyScalaFile=`git status | grep "modified:" | grep -G "\.scala$" | grep ".java"| wc -l | awk '{print $1}'`
modifyMarkFile=`git status | grep "modified:" | grep -G "\.md$" | grep ".java"| wc -l | awk '{print $1}'`
echo "本次共修改Java文件数：${modifyJavaFile}，本次共修改Scala文件数：${modifyScalaFile}，本次共修改markdown文件数：${modifyMarkFile}"
delJavaFile=`git status | grep "deleted:" | grep -G "\.java$" | grep ".java"| wc -l | awk '{print $1}'`
delScalaFile=`git status | grep "deleted:" | grep -G "\.scala$" | grep ".java"| wc -l | awk '{print $1}'`
delMarkFile=`git status | grep "deleted:" | grep -G "\.md$" | grep ".java"| wc -l | awk '{print $1}'`
echo "本次共删除Java文件数：${delJavaFile}，本次共删除Scala文件数：${delScalaFile}，本次共删除markdown文件数：${delMarkFile}"

#新增的不需显示
newFile=`git status | grep "new file:" | wc -l | awk '{print $1}'`
echo "本次共新增文件数：${newFile}"

git add .
git commit -m "${1}，时间：$starttime"
git push origin master
```
